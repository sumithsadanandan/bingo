<!-- Audio -->
<audio id="bingoSound" src="https://www.myinstants.com/media/sounds/bingo.mp3"></audio>

<script>
    const SIZE = 5;
    let cells = [];
    let completedLines = new Set();
    window.bingoAnnounced = false;
    let audioEnabled = false; // Safari requires user tap

    function generateBoard() {
        const grid = document.getElementById("grid");
        grid.innerHTML = "";
        cells = [];
        completedLines.clear();
        window.bingoAnnounced = false;
        audioEnabled = false;

        document.querySelectorAll('.letter').forEach(l => l.classList.remove('active'));

        let numbers = Array.from({ length: 25 }, (_, i) => i + 1);
        // Shuffle
        for (let i = numbers.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
        }

        numbers.forEach((num) => {
            const div = document.createElement("div");
            div.className = "cell";
            div.textContent = num;

            div.onclick = () => {
                // First tap unlocks audio
                if (!audioEnabled) {
                    document.getElementById('bingoSound').play().catch(()=>{});
                    document.getElementById('bingoSound').pause();
                    audioEnabled = true;
                }

                div.classList.toggle("marked");
                checkCompletedLines();
            };

            cells.push(div);
            grid.appendChild(div);
        });
    }

    function checkCompletedLines() {
        cells.forEach(c => c.classList.remove("completed"));
        let lines = [];

        // Rows
        for (let r = 0; r < SIZE; r++) {
            lines.push([...Array(SIZE)].map((_, c) => r * SIZE + c));
        }

        // Columns
        for (let c = 0; c < SIZE; c++) {
            lines.push([...Array(SIZE)].map((_, r) => r * SIZE + c));
        }

        lines.forEach((line, index) => {
            if (line.every(i => cells[i].classList.contains("marked"))) {
                line.forEach(i => cells[i].classList.add("completed"));
                completedLines.add(index);
            }
        });

        updateBingoLetters();
    }

    function updateBingoLetters() {
        const letters = ['b','i','n','g','o'];
        letters.forEach((id,i)=>{
            document.getElementById(id)
                    .classList.toggle('active',completedLines.size>i);
        });

        if (completedLines.size >=5 && !window.bingoAnnounced) {
            window.bingoAnnounced = true;
            // Play sound only if audio is unlocked
            if (audioEnabled) {
                const audio = document.getElementById('bingoSound');
                audio.currentTime = 0;
                audio.play().catch(()=>console.log("Audio blocked"));
            }
            alert("BINGO! ðŸŽ‰");
        }
    }

    generateBoard();
</script>
